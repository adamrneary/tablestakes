<!DOCTYPE html>

<html>
<head>
  <title>tablestakes.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="column.html">
                column.coffee
              </a>
            
              
              <a class="source" href="events.html">
                events.coffee
              </a>
            
              
              <a class="source" href="render.html">
                render.coffee
              </a>
            
              
              <a class="source" href="tablestakes.html">
                tablestakes.coffee
              </a>
            
              
              <a class="source" href="utils.html">
                utils.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>tablestakes.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class="highlight"><pre><span class="class"><span class="keyword">class</span> <span class="title">window</span>.<span class="title">TableStakes</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>internal table settings/variables</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>id : Math.floor(Math.random() * <span class="number">10000</span>)
  header : <span class="literal">true</span>
  noData : <span class="string">"No Data Available."</span>
  childIndent : <span class="number">20</span>
  tableClassName : <span class="string">"tablestakes"</span>
  gridData : []
  gridFilteredData : []
  tableObject : <span class="literal">null</span>
  isInRender : <span class="literal">false</span>
  filterCondition : []
  dispatch : d3.dispatch(
    <span class="string">"elementClick"</span>, <span class="string">"elementDblclick"</span>, <span class="string">"elementMouseover"</span>, <span class="string">"elementMouseout"</span>
  )</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>defaults</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>_columns: []
  _margin :
    top: <span class="number">0</span>
    right: <span class="number">0</span>
    bottom: <span class="number">0</span>
    left: <span class="number">0</span>

  constructor: (options) -&gt;
    <span class="property">@core</span> = <span class="keyword">new</span> window.TableStakesLib.Core</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>builds getter/setter methods (initialized with defaults)</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="property">@_synthesize</span>
      data: []
      el: <span class="literal">null</span>
      isDeletable: <span class="literal">false</span>
      onDelete: <span class="literal">null</span>
      isResizable: <span class="literal">true</span>
      isSortable: <span class="literal">false</span>
      dragMode: <span class="literal">null</span>
      isDraggable: <span class="literal">false</span>
      onDrag: <span class="literal">null</span>
      isDragDestination: <span class="literal">true</span>
      rowClasses: <span class="literal">null</span>

    <span class="property">@filterCondition</span> = d3.map([])
    <span class="keyword">if</span> options?
      <span class="keyword">for</span> key <span class="keyword">of</span> options
        <span class="property">@set</span> key, options[key]

  render: -&gt;
    <span class="property">@gridData</span> = [values: <span class="property">@data</span>()]
    <span class="property">@columns</span>().forEach (column, i) =&gt;
      <span class="property">@gridData</span>[<span class="number">0</span>][column[<span class="string">'id'</span>]] = column[<span class="string">'id'</span>]
    <span class="property">@setID</span> <span class="property">@gridData</span>[<span class="number">0</span>], <span class="string">"0"</span>
    <span class="property">@gridFilteredData</span> = <span class="property">@gridData</span>
    <span class="property">@_setFilter</span> <span class="property">@gridFilteredData</span>[<span class="number">0</span>], <span class="property">@filterCondition</span>
    d3.select(<span class="property">@el</span>())
      .html(<span class="string">''</span>)
      .datum(<span class="property">@gridFilteredData</span>)
      .call( (selection) =&gt; <span class="property">@update</span> selection)</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>@dispatchManualEvent(d3.select(&#39;td&#39;).node())</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>@

  update: (selection) -&gt;
    selection.each (data) =&gt;
      <span class="property">@core</span>.set
        selection: selection
        table: @
        data: data
      <span class="property">@core</span>.render()

    <span class="property">@isInRender</span> = <span class="literal">false</span>
    @

  dispatchManualEvent: (target) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>all browsers except IE before version 9</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="keyword">if</span> target.dispatchEvent <span class="keyword">and</span> document.createEvent
      mousedownEvent = document.createEvent(<span class="string">"MouseEvent"</span>)
      mousedownEvent.initMouseEvent(
        <span class="string">"dblclick"</span>, <span class="literal">true</span>, <span class="literal">true</span>, window, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,
        <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="number">0</span>, <span class="literal">null</span>
      )
      target.dispatchEvent(mousedownEvent)
    <span class="keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>IE before version 9</p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="keyword">if</span> document.createEventObject
        mousedownEvent = document.createEventObject(window.event)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>left button is down</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>mousedownEvent.button = <span class="number">1</span>
        target.fireEvent(<span class="string">"dblclick"</span>, mousedownEvent)
    <span class="keyword">return</span>

  setID : (node, prefix) -&gt;
    node[<span class="string">'_id'</span>] = prefix
    <span class="keyword">if</span> node.values
      node.values.forEach (subnode, i) =&gt;
        <span class="property">@setID</span> subnode, prefix+<span class="string">"_"</span>+i
    <span class="keyword">if</span> node._values
      node._values.forEach (subnode, i) =&gt;
        <span class="property">@setID</span> subnode, prefix+<span class="string">"_"</span>+i

  filter: (key, value) -&gt;
    value = value <span class="keyword">or</span> <span class="string">''</span>
    value = value.toString().toUpperCase()
    <span class="property">@filterCondition</span>.set key, value
    <span class="property">@_setFilter</span> <span class="property">@gridFilteredData</span>[<span class="number">0</span>], <span class="property">@filterCondition</span>
    <span class="property">@render</span>()

  _setFilter: ( data, filter ) -&gt;
    self = <span class="keyword">this</span>
    data <span class="keyword">or</span>= []
    <span class="keyword">if</span> <span class="keyword">typeof</span> data._hiddenvalues == <span class="string">"undefined"</span>
      data[<span class="string">'_hiddenvalues'</span>] = []
    <span class="keyword">if</span> data.values
      data.values = data.values.concat(data._hiddenvalues)
      data._hiddenvalues = []
      <span class="keyword">for</span> i <span class="keyword">in</span> [data.values.length-<span class="number">1.</span><span class="number">.0</span>] <span class="keyword">by</span> -<span class="number">1</span>
        <span class="keyword">if</span> <span class="property">@_setFilter</span>(data.values[i], filter) == <span class="literal">null</span>
          data._hiddenvalues.push(data.values.splice(i, <span class="number">1</span>)[<span class="number">0</span>])
    <span class="keyword">if</span> data._values
      data._values = data._values.concat(data._hiddenvalues)
      data._hiddenvalues = []
      <span class="keyword">for</span> i <span class="keyword">in</span> [data._values.length-<span class="number">1.</span><span class="number">.0</span>] <span class="keyword">by</span> -<span class="number">1</span>
        <span class="keyword">if</span> <span class="property">@_setFilter</span>(data._values[i], filter) == <span class="literal">null</span>
          data._hiddenvalues.push(data._values.splice(i, <span class="number">1</span>)[<span class="number">0</span>])

    <span class="keyword">if</span> data.values <span class="keyword">and</span> data.values.length &gt; <span class="number">0</span>
      <span class="keyword">return</span> data
    <span class="keyword">if</span> data._values <span class="keyword">and</span> data._values.length &gt; <span class="number">0</span>
      <span class="keyword">return</span> data

    matchFound = <span class="literal">true</span>
    <span class="keyword">for</span> key <span class="keyword">in</span> filter.keys()
      <span class="keyword">if</span> data[key]</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>arr = d3.map data[key], (d) -&gt;
d.toUpperCase()</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>_data = data[key].toUpperCase()
        <span class="keyword">if</span> _data.indexOf(filter.get(key)) == -<span class="number">1</span>
          matchFound = <span class="literal">false</span>
      <span class="keyword">else</span>
        matchFound = <span class="literal">false</span>
    <span class="keyword">if</span> matchFound
      <span class="keyword">return</span> data
    <span class="keyword">return</span> <span class="literal">null</span>

  get: (key) -&gt;
    @[key]

  set: (key, value, options) -&gt;
    @[key] = (<span class="keyword">if</span> value? <span class="keyword">then</span> value <span class="keyword">else</span> <span class="literal">true</span>) <span class="keyword">if</span> key?
    @

  <span class="keyword">is</span>: (key) -&gt;
    <span class="keyword">if</span> @[key] <span class="keyword">then</span> <span class="literal">true</span> <span class="keyword">else</span> <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2>Expose Public Variables</h2>
<p>The following are getter/setter methods
See <a href="http://bost.ocks.org/mike/chart">http://bost.ocks.org/mike/chart</a> for more details.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>margin: (val) -&gt;
    <span class="keyword">return</span> <span class="property">@_margin</span> <span class="keyword">unless</span> val?
    <span class="keyword">for</span> side <span class="keyword">in</span> [<span class="string">'top'</span>,<span class="string">'right'</span>,<span class="string">'bottom'</span>,<span class="string">'left'</span>]
      <span class="property">@_margin</span>[side] = val[side] <span class="keyword">unless</span> <span class="keyword">typeof</span> val[side] <span class="keyword">is</span> <span class="string">"undefined"</span>
    @

  columns: (val) -&gt;
    <span class="keyword">return</span> <span class="property">@_columns</span> <span class="keyword">unless</span> val?
    <span class="property">@_columns</span> = []
    val = [val] <span class="keyword">unless</span> _.isArray(val)
    _.each val, (column) =&gt;
      c = <span class="keyword">new</span> window.TableStakesLib.Column(column)
      <span class="property">@_columns</span>.push c
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>builds getter/setter methods (initialized with defaults)</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>_synthesize: (hash) -&gt;
    _.each hash, (value, key) =&gt;
      @[<span class="string">'_'</span> + key] = value
      <span class="function"><span class="title">func</span></span> = (key) =&gt;
        @[key] = (val) -&gt;
          <span class="keyword">return</span> @[<span class="string">'_'</span> + key] <span class="keyword">unless</span> val?
          @[<span class="string">'_'</span> + key] = val
          @
      func(key)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
