// Generated by CoffeeScript 1.4.0

describe("column", function() {
  return it('constructor', function(done) {
    var column;
    column = new window.TableStakesLib.Column({
      a: 'b'
    });
    assert(column);
    assert(column.a === 'b');
    return done();
  });
});

describe("Events", function() {
  var column, columns, d, data, event, table;
  event = null;
  table = null;
  data = [
    {
      id: "NVD3",
      type: "ahaha",
      values: [
        {
          id: "Charts",
          _values: [
            {
              id: "Simple Line",
              type: "Historical"
            }, {
              id: "Scatter / Bubble",
              type: "Snapshot"
            }, {
              id: "Stacked / Stream / Expanded Area",
              type: "Historical"
            }, {
              id: "Discrete Bar",
              type: "Snapshot"
            }, {
              id: "Grouped / Stacked Multi-Bar",
              type: "Snapshot / Historical"
            }, {
              id: "Horizontal Grouped Bar",
              type: "Snapshot"
            }, {
              id: "Line and Bar Combo",
              type: "Historical"
            }, {
              id: "Cumulative Line",
              type: "Historical"
            }, {
              id: "Line with View Finder",
              type: "Historical"
            }
          ]
        }, {
          id: "Chart Components",
          values: [
            {
              id: "Legend",
              type: "Universal"
            }
          ]
        }
      ]
    }, {
      id: "New Root",
      type: "tatata",
      classes: "rowcustom1",
      values: [
        {
          id: "1",
          type: "123",
          classes: "rowcustom"
        }
      ]
    }
  ];
  columns = [
    {
      id: "id",
      label: "Name",
      classes: 'row-heading',
      isEditable: true,
      isNested: true
    }, {
      id: "type",
      label: "Type",
      isEditable: true
    }
  ];
  d = {
    _hiddenvalues: [],
    _id: "0_6",
    activatedID: "Simple Line",
    changedID: null,
    depth: 1,
    id: "Simple Line",
    parent: {},
    type: "Snapshot",
    x: 0.5,
    y: 1
  };
  column = {
    id: "id",
    label: "Name",
    classes: "row-heading",
    onEdit: function() {
      return d.id = 'test';
    }
  };
  it('window.TableStakesLib.Events is function', function(done) {
    assert(window.TableStakesLib);
    assert(typeof window.TableStakesLib.Events === 'function');
    assert(window.TableStakesLib.Events);
    return done();
  });
  it('events constructor', function(done) {
    event = new window.TableStakesLib.Events({
      core: {
        table: {
          isInRender: false,
          el: function() {
            return '#example';
          },
          onDrag: function() {
            return d;
          },
          dragMode: function() {
            return 'reorder';
          }
        },
        update: function() {
          return true;
        },
        utils: {
          getCurrentColumnIndex: function() {
            return 3;
          },
          findNextNode: function() {
            return d;
          },
          findPrevNode: function() {
            return d;
          },
          deactivateAll: function() {
            return true;
          }
        },
        columns: [
          {
            'id': 2
          }, {
            'id': 3
          }, {
            'id': 4
          }
        ],
        nodes: [],
        data: [
          {
            'id': 2
          }
        ]
      }
    });
    assert(event);
    return done();
  });
  it('blur', function(done) {
    var td;
    table = new window.TableStakes().el("#example").data(data).columns(column);
    td = d3.select('#NVD3');
    assert(event.blur(td, d, column));
    return done();
  });
  it('keydown press tab, shiftKey-false and ColumnIndex=3', function(done) {
    var td, _table;
    d3.event = {
      'keyCode': 9,
      'shiftKey': false,
      preventDefault: function() {
        return true;
      },
      stopPropagation: function() {
        return true;
      }
    };
    _table = new window.TableStakes().el("#example").columns(columns).data(data).render();
    event = _table.core.events;
    td = d3.select('td').node();
    assert(event.keydown(td, d, column));
    return done();
  });
  it('keydown press tab, shiftKey-false and ColumnIndex = 1', function(done) {
    var td, _table;
    d3.event = {
      'keyCode': 9,
      'shiftKey': false,
      preventDefault: function() {
        return true;
      },
      stopPropagation: function() {
        return true;
      }
    };
    td = d3.select('td').node();
    _table = new window.TableStakes().el("#example").columns(columns).data(data).render();
    event = _table.core.events;
    td = d3.select('td').node();
    assert(event.keydown(td, d, column));
    return done();
  });
  it('keydown press tab, shiftKey-true and ColumnIndex = 3', function(done) {
    var td, _table;
    d3.event = {
      'keyCode': 9,
      'shiftKey': true,
      preventDefault: function() {
        return true;
      },
      stopPropagation: function() {
        return true;
      }
    };
    _table = new window.TableStakes().el("#example").columns(columns).data(data).render();
    event = _table.core.events;
    td = d3.select('td').node();
    assert(event.keydown(td, d, column));
    return done();
  });
  it('keydown press tab, shiftKey-true and  ColumnIndex = 0', function(done) {
    var td, _table;
    d3.event = {
      'keyCode': 9,
      'shiftKey': true,
      preventDefault: function() {
        return true;
      },
      stopPropagation: function() {
        return true;
      }
    };
    td = d3.select('td').node();
    _table = new window.TableStakes().el("#example").columns(columns).data(data).render();
    event = _table.core.events;
    td = d3.select('td').node();
    assert(event.keydown(td, d, column));
    return done();
  });
  it('keydown press up', function(done) {
    var td, _table;
    d3.event = {
      'keyCode': 38,
      'shiftKey': true,
      preventDefault: function() {
        return true;
      },
      stopPropagation: function() {
        return true;
      }
    };
    _table = new window.TableStakes().el("#example").columns(columns).data(data).render();
    event = _table.core.events;
    td = d3.select('td').node();
    assert(event.keydown(td, d, column));
    return done();
  });
  it('keydown press down', function(done) {
    var td, _table;
    d3.event = {
      'keyCode': 40,
      'shiftKey': true,
      preventDefault: function() {
        return true;
      },
      stopPropagation: function() {
        return true;
      }
    };
    _table = new window.TableStakes().el("#example").columns(columns).data(data).render();
    event = _table.core.events;
    td = d3.select('td').node();
    assert(event.keydown(td, d, column));
    return done();
  });
  it('keydown press Enter', function(done) {
    var td;
    d3.event = {
      'keyCode': 13,
      'shiftKey': true,
      preventDefault: function() {
        return true;
      },
      stopPropagation: function() {
        return true;
      }
    };
    td = d3.select('#NVD3');
    assert(event.keydown(td, d, column));
    return done();
  });
  it('keydown press Escape', function(done) {
    var td;
    d3.event = {
      'keyCode': 27,
      'shiftKey': true,
      'x': 45,
      'y': 56,
      preventDefault: function() {
        return true;
      },
      stopPropagation: function() {
        return true;
      }
    };
    td = d3.select('#NVD3');
    assert(event.keydown(td, d, column));
    return done();
  });
  it('dragStart', function(done) {
    var tr;
    tr = d3.select('#NVD3');
    tr['getBoundingClientRect'] = function() {
      return [34, 23];
    };
    return done();
  });
  it('dragMove', function(done) {
    var tr;
    tr = d3.select('#NVD3');
    return done();
  });
  it('resizeDrag');
  it('editableClick', function(done) {
    var td;
    td = d3.select('#NVD3');
    return done();
  });
  it('nestedClick', function(done) {
    var a, td;
    td = d3.select('td').node();
    a = {
      values: [3, 8]
    };
    d.values = [a];
    assert(event.nestedClick(td, d, 2, false));
    assert(d.values[0].values === null);
    assert(d.values[0]._values !== null);
    assert(event.nestedClick(td, d, 2, true));
    assert(d.values === null);
    assert(d._values !== null);
    assert(event.nestedClick(td, d, 2, true));
    assert(d.values !== null);
    assert(d._values === null);
    return done();
  });
  it('toggleBoolean', function(done) {
    var td;
    td = d3.select('td').node();
    assert(event.toggleBoolean(td, d, 2, 0, column));
    assert(d.id === 'test');
    return done();
  });
  return it('selectClick', function(done) {
    var td;
    d.id = 0;
    d3.event = {
      target: {
        value: 1
      }
    };
    td = d3.select('td').node();
    assert(event.selectClick(td, d, 2, 0, column));
    assert(d.id === 'test');
    return done();
  });
});

describe("Render", function() {
  var categories, columns, data, editHandler, render, table, table2;
  render = null;
  table = null;
  table2 = null;
  data = [
    {
      id: "task 1",
      category: "engineering",
      date: '2013-01-01',
      complete: true,
      classes: "total"
    }, {
      id: "task 2",
      category: "qa",
      date: '2013-02-01',
      complete: true
    }
  ];
  categories = ['engineering', 'design', 'qa'];
  editHandler = function(id, field, newValue) {
    var row, _i, _len;
    for (_i = 0, _len = data.length; _i < _len; _i++) {
      row = data[_i];
      if (row.id === id) {
        row[field] = newValue;
      }
    }
    return table.data(data).render();
  };
  columns = [
    {
      id: "id",
      label: "Task",
      classes: "row-heading",
      isEditable: true,
      onEdit: editHandler
    }, {
      id: "category",
      label: "Task category",
      isEditable: true,
      editor: 'select',
      selectOptions: categories,
      onEdit: editHandler
    }, {
      id: "date",
      label: "Date due",
      isEditable: true,
      editor: 'calendar',
      onEdit: editHandler,
      showCount: true
    }, {
      id: "complete",
      label: "Is complete",
      isEditable: true,
      editor: 'boolean',
      onEdit: editHandler
    }
  ];
  it('is a function', function(done) {
    assert(window.TableStakes);
    assert(typeof window.TableStakes === 'function');
    return done();
  });
  it('window.TableStakesLib.Core', function(done) {
    var deleteCheck, deleteHandler;
    deleteCheck = function(d) {
      return d.type === 'Historical' || d.type === 'Snapshot';
    };
    deleteHandler = function(id) {
      data = _.reject(data, function(row) {
        return row.id === id;
      });
      return table.data(data).render();
    };
    table = new window.TableStakes().el("#example").columns(columns).data(data).isDeletable(deleteCheck).onDelete(deleteHandler).dragMode('reorder').isDraggable(true).render().rowClasses(function(d) {
      if (d.etc === 'etc6') {
        return "total2";
      }
    });
    return done();
  });
  it('render constructor', function(done) {
    render = new window.TableStakesLib.Core;
    render['table'] = {
      isDraggable: function() {
        return false;
      }
    };
    assert(render);
    return done();
  });
  return it('update', function(done) {
    var rendertest;
    rendertest = new window.TableStakesLib.Core;
    rendertest['table'] = {
      isInRender: false,
      isDraggable: function() {
        return false;
      },
      update: function() {
        return true;
      }
    };
    rendertest['selection'] = {
      transition: function() {
        return {
          call: function() {
            return true;
          }
        };
      }
    };
    assert(rendertest.update());
    return done();
  });
});

describe("Tablestakes API ", function() {
  var columns, data, editHandler, setNewTreeValue, table;
  table = null;
  data = [
    {
      id: "NVD3",
      type: "ahaha",
      values: [
        {
          id: "Charts",
          values: [
            {
              id: "Simple Line",
              type: "Historical",
              values: [
                {
                  id: "Scatter / Bubble",
                  type: "Snapshot",
                  values: [
                    {
                      id: "Stacked / Stream / Expanded Area",
                      type: "Historical",
                      values: [
                        {
                          id: "Stacked / Stream / Expanded Area",
                          type: "Historical",
                          values: [
                            {
                              id: "Line and Bar Combo",
                              type: "Historical",
                              values: [
                                {
                                  id: "Cumulative Line",
                                  type: "Historical"
                                }
                              ]
                            }, {
                              id: "Cumulative Line",
                              type: "Historical"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }, {
          id: "Chart Components",
          _values: [
            {
              id: "Legend",
              type: "Universal"
            }
          ]
        }
      ]
    }
  ];
  setNewTreeValue = function(tree, id, field, newValue) {
    var node, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = tree.length; _i < _len; _i++) {
      node = tree[_i];
      if (node.id === id) {
        _results.push(node[field] = newValue);
      } else if (node.values != null) {
        _results.push(setNewTreeValue(node.values, id, field, newValue));
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };
  editHandler = function(id, field, newValue) {
    setNewTreeValue(data, id, field, newValue);
    return table.data(data).render();
  };
  columns = [
    {
      id: "id",
      label: "Name",
      isEditable: true,
      isNested: true,
      onEdit: editHandler
    }, {
      id: "type",
      label: "Type",
      isEditable: true,
      onEdit: editHandler
    }
  ];
  it('is a function', function(done) {
    assert(window.TableStakes);
    assert(typeof window.TableStakes === 'function');
    return done();
  });
  it('has a basic constructor', function(done) {
    table = new window.TableStakes;
    table.render();
    assert(table);
    return done();
  });
  describe("chainable getter/setter methods for most internal attributes", function() {
    return it('should return the value set by the same method', function() {
      var attributes;
      attributes = ['data', 'isDeletable', 'onDelete', 'isResizable', 'isSortable', 'dragMode', 'isDraggable', 'onDrag', 'isDragDestination', 'el', 'rowClasses'];
      return _.each(attributes, function(attribute) {
        var testVal;
        testVal = Math.random();
        assert(table[attribute](testVal) === table);
        return assert(table[attribute]() === testVal);
      });
    });
  });
  describe("margin", function() {
    it('can set all margin attributes at once', function(done) {
      var testHash;
      testHash = {
        top: 40,
        right: 10,
        bottom: 30,
        left: 50
      };
      assert(table.margin(testHash) === table);
      assert(table.margin()['top'] === 40);
      assert(table.margin()['right'] === 10);
      assert(table.margin()['bottom'] === 30);
      assert(table.margin()['left'] === 50);
      return done();
    });
    return it('can set 1-2 margin attributes at a time', function(done) {
      var testHash;
      testHash = {
        top: 40,
        right: 10,
        bottom: 30,
        left: 50
      };
      assert(table.margin(testHash) === table);
      assert(table.margin({
        top: 100
      }) === table);
      assert(table.margin({
        left: 200,
        right: 300
      }) === table);
      assert(table.margin()['top'] === 100);
      assert(table.margin()['right'] === 300);
      assert(table.margin()['bottom'] === 30);
      assert(table.margin()['left'] === 200);
      return done();
    });
  });
  return describe("columns", function() {
    it('returns table on set and an array of Columns on get');
    it('table options', function(done) {
      typeof table.filterCondition === 'object';
      table.filterCondition === 'd3_Map';
      typeof table.core === 'object';
      table.core === 'core';
      typeof table.events === 'object';
      table.events === 'events';
      typeof table.utils === 'object';
      table.utils === 'utils';
      return done();
    });
    it('column', function(done) {
      table = new window.TableStakes().el("#example").data(data);
      assert(table.columns(columns));
      return done();
    });
    it('setID', function(done) {
      var _this = this;
      table.gridData = [
        {
          values: table.data()
        }
      ];
      table.columns().forEach(function(column, i) {
        return table.gridData[0][column['id']] = column['id'];
      });
      table.setID(table.gridData[0], "0");
      assert(table.gridData[0]._id === "0");
      return done();
    });
    it('render', function(done) {
      assert(typeof table.render === 'function');
      assert(table.render());
      return done();
    });
    it('update', function(done) {
      var _this = this;
      d3.select(table.el()).html('').call(function(selection) {
        return assert(table.update(selection));
      });
      assert(typeof table.update === 'function');
      return done();
    });
    it('dispatchManualEvent', function(done) {
      assert(typeof table.dispatchManualEvent === 'function');
      return done();
    });
    it('table.set(testdata) and table.get(testdata)', function(done) {
      assert(table.set('isResizable', true));
      assert(table.get('isResizable') === true);
      return done();
    });
    it('table.is(testdata)', function(done) {
      assert(table.is('isResizable') === true);
      return done();
    });
    it('columns', function(done) {
      table = new window.TableStakes().el("#example").data(data);
      columns = 'isnt array';
      assert(table.columns(columns));
      return done();
    });
    it('table.is(testdata)', function(done) {
      assert(table.is('isResizable') === true);
      assert(table.is('isEditable') === false);
      return done();
    });
    it('filter', function(done) {
      assert(typeof table.filter === 'function');
      assert(table.filter('key', 'S'));
      assert(table.filter('id', 'NVD3'));
      assert(table.filterCondition.get('id') === 'NVD3');
      return done();
    });
    return it('has a basic constructor', function(done) {
      table = new window.TableStakes({
        'editable': true
      });
      assert(table);
      return done();
    });
  });
});

describe("Utils", function() {
  var a, b, c, d, f, table, utils;
  table = null;
  utils = null;
  d = {
    values: ['a'],
    _values: [],
    activatedID: true
  };
  a = {
    values: [],
    activatedID: true
  };
  b = {
    _values: [a],
    activatedID: true
  };
  c = {
    activatedID: true,
    parent: {
      values: [],
      activatedID: true
    }
  };
  c.parent.values = [b, c];
  c.parent.children = [b, c];
  f = {
    values: [a, c],
    activatedID: true
  };
  it('window.TableStakesLib.Utils is function', function(done) {
    assert(typeof window.TableStakesLib.Utils === 'function');
    return done();
  });
  it('utils constructor', function(done) {
    utils = new window.TableStakesLib.Utils({
      core: {
        utils: {
          deactivateAll: function(d) {
            return d.activatedID = null;
          },
          hasChildren: function() {
            return true;
          },
          isChild: function() {
            return true;
          }
        },
        data: [
          {
            values: [
              {
                _id: "0_0",
                values: [
                  {
                    _id: "0_0_0"
                  }
                ]
              }
            ],
            _id: "0"
          }
        ],
        columns: [
          {
            id: 'id'
          }, {
            id: 'type'
          }
        ],
        nodes: [
          {
            _id: "0"
          }, {
            _id: "0_0"
          }, {
            _id: "0_0_0"
          }
        ],
        table: {
          gridFilteredData: [
            {
              values: [
                {
                  _id: "0_0",
                  values: [
                    {
                      _id: "0_0_0"
                    }
                  ]
                }
              ],
              _id: "0"
            }
          ],
          setID: function() {
            return true;
          }
        }
      }
    });
    assert(utils);
    return done();
  });
  it('hasChildren', function(done) {
    assert(utils.hasChildren(d));
    assert(utils.hasChildren(a) === 0);
    return done();
  });
  it('folded', function(done) {
    assert(utils.folded(d) === 0);
    return done();
  });
  it('appendNode', function(done) {
    assert(d.values.length === 1);
    utils.appendNode(d, a);
    assert(d.values.length === 2);
    assert(b._values.length === 1);
    utils.appendNode(b, a);
    assert(b._values.length === 2);
    utils.appendNode(c, a);
    assert(c.values.length === 1);
    return done();
  });
  it('pastNode', function(done) {
    utils.pastNode(c, a);
    assert(c.parent.values[2] === a);
    return done();
  });
  it('removeNode', function(done) {
    utils.removeNode(c);
    assert(c.parent.values.length === 2);
    return done();
  });
  it('findNextNode', function(done) {
    assert(utils.findNextNode({
      _id: "0_0"
    })._id === "0_0_0");
    assert(utils.findNextNode({
      _id: "0_0_0"
    }) === null);
    return done();
  });
  it('findPrevNode', function(done) {
    assert(utils.findPrevNode({
      _id: "0_0_0"
    })._id === "0_0");
    assert(utils.findPrevNode({
      _id: "0_0"
    }) === null);
    return done();
  });
  it('findNodeByID', function(done) {
    utils.findNodeByID("0_0") === {
      _id: "0_0",
      values: [
        {
          _id: "0_0_0"
        }
      ]
    };
    return done();
  });
  it('getCurrentColumnIndex', function(done) {
    assert(utils.getCurrentColumnIndex('id') === 0);
    return done();
  });
  it('deactivateAll', function(done) {
    utils.deactivateAll(f);
    assert(f.activatedID === null);
    assert(c.activatedID === null);
    assert(a.activatedID === null);
    utils.deactivateAll(b);
    assert(b.activatedID === null);
    return done();
  });
  it('isChild', function(done) {
    var utilsTest2;
    assert(utils.isChild(d, b));
    assert(utils.isChild(a, f));
    utilsTest2 = new window.TableStakesLib.Utils({
      core: {
        utils: {
          deactivateAll: function(d) {
            return d.activatedID = null;
          },
          hasChildren: function() {
            return false;
          },
          isChild: function() {
            return false;
          }
        }
      }
    });
    assert(utilsTest2.isChild(f, a) === false);
    return done();
  });
  return it('isParent', function(done) {
    var utilsTest;
    utils.isParent(a, d);
    utilsTest = new window.TableStakesLib.Utils({
      core: {
        utils: {
          deactivateAll: function(d) {
            return d.activatedID = null;
          },
          hasChildren: function() {
            return false;
          }
        }
      }
    });
    utilsTest.isParent(a, d);
    return done();
  });
});
